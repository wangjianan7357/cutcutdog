<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Hello MUI</title>
	<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<!--标准mui.css-->
	<link rel="stylesheet" href="css/mui.min.css">
	<style>
		.title {
			margin: 20px 15px 10px;
			color: #6d6d72;
			font-size: 15px;
		}
	</style>
	<script src="js/mui.min.js"></script>
    <script src="js/jquery.min.js"></script>
    <script src="js/template-native.js"></script>
    <script src="js/basic.js"></script>
</head>

<body>
	<header class="mui-bar mui-bar-nav">
		<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		<h1 class="mui-title">media list（图文列表）</h1>
	</header>
	<div class="mui-content">
		<div class="title">
			右侧带导航箭头
		</div>
		
		<ul class="mui-table-view mui-table-view-chevron" id="list-view">
		<script id="list-view-code" type="text/html">
			<% for (var i in list) { %>
			<li class="mui-table-view-cell mui-media">
				<a class="mui-navigate-right" href="info-detail-nr.html" data-action="webview">
					<img class="mui-media-object mui-pull-left" src="<%= getvarious("domain") + "uploads/pictures/info/imm" + list[i]["src"] %>" />
					<div class="mui-media-body">
						<%= list[i]["name"] %>
						<p class='mui-ellipsis'><%= list[i]["desp"] %></p>
					</div>
				</a>
			</li>
			<% } %>
		</script>
		</ul>
	</div>

	<script>
		(function($, doc) {
			$.init({
				swipeBack:true //启用右滑关闭功能
			});

			var loadComment = function() {
				$.ajax({
					type: "post",
					url: domain + "saas/message.php",
					dataType: "json",
					data: {
						action: "list",
						where: {path: getUrlParam("url")}
					},
					async: true,
					success: function(json) {
						if(!json.error) {
							jQuery("#list-view").html(template('list-view-code', json));
							assignTmpl(json);

						}
					},
					error: function(xhr, type, errorThrown) {

					}
				});
			}
			
			$.plusReady(function() {
				$.ajax({
					type: "post",
					url: domain + "saas/catalog.php",
					dataType: "json",
					data: {
						action: "detail",
						where: {path: getUrlParam("url")}
					},
					async: true,
					success: function(json) {
						if(!json.error) {
							jQuery("#list-view").html(template('list-view-code', json));
							assignTmpl(json);

							// 加载评论
							//loadComment();
							
						} else {
							plus.nativeUI.toast(json.message);
						}
					},
					error: function(xhr, type, errorThrown) {}
				});

				jQuery("[data-action='comment']").click(function(){
					var content = $(this).parent().find("textarea").html();

					if (content) {
						var member = myStorage.getItem("member");
						var target = $(this).parent().find("textarea").attr("data-sign");

						$.ajax({
							type: "post",
							url: domain + "saas/message.php",
							dataType: "json",
							data: {
								action: "insert",
								params: {
									aid: target,
									atype: 3,
									mid: member.id,
									content: content,
									type: 1
								}
							},
							async: true,
							success: function(json) {
								if(!json.error) {

									
								} else {
									//plus.nativeUI.toast(json.message);
								}
							},
							error: function(xhr, type, errorThrown) {}
						});
					}
				});
			});
		}(mui, document));
</script>
</body>
</html>