<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Hello MUI</title>
	<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">

	<link rel="stylesheet" href="css/mui.min.css">
	<link rel="stylesheet" type="text/css" href="css/feedback-page.css" />

	<script src="js/mui.min.js "></script>
	<script src="js/mui.view.js "></script>
    <script src="js/jquery.min.js"></script>
	<script src='libs/easymob-webim-sdk/strophe-custom-2.0.0.js'></script>
	<script src='libs/easymob-webim-sdk/json2.js'></script>
	<script src="libs/easymob-webim-sdk/easemob.im-1.0.5.js"></script>
	<script src="js/mui.locker.js"></script>
    <script src="js/basic.js"></script>
</head>

<body class="mui-fullscreen">
	<header class="mui-bar mui-bar-nav">
		<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"><img src="images/home.png"></a>
		<h1 class="mui-title"><img src="images/Petchat.png"> <img src="images/CatDog.png"></h1>
		<div style=" float: right; margin-top: 10px; font-weight: 600; color: #333;">登出</div>
	</header>

	<!--页面主结构开始-->
	<div id="app" class="mui-views">
		<div class="mui-view">
			<div class="mui-navbar">
			</div>
			<div class="mui-pages">
			</div>
		</div>
	</div>
	<!--页面主结构结束-->
	<!--单页面开始-->
	<div id="setting" class="mui-page">
		
		<!--页面标题栏开始-->
		<div class="mui-navbar-inner mui-bar mui-bar-nav">
			
		</div>
		<!--页面标题栏结束-->
		<!--页面主内容区开始-->
		<div class="mui-page-content">
			<div class="mui-scroll-wrapper">
				<div class="mui-scroll">
					<ul class="mui-table-view mui-table-view-chevron">
						<li class="mui-table-view-cell mui-media">
							<a class="mui-navigate-right" href="#account">
								<img class="mui-media-object mui-pull-left head-img" id="head-img" src="images/user-photo.png"  data-before-info="domain" data-info="src=member.src" />
								<div class="mui-media-body">
									<span data-info="member.name"></span>
									<p class='mui-ellipsis'>賬號: <span data-info="member.name"></span></p>
								</div>
							</a>
						</li>
					</ul>
					<ul class="mui-table-view mui-table-view-chevron">
						<li class="mui-table-view-cell">
							<a href="#account" class="mui-navigate-right">賬號與安全</a>
						</li>
					</ul>
					
	                <ul class="mui-table-view mui-table-view-chevron">
						<li class="mui-table-view-cell">
							<a href="#about" class="mui-navigate-right">關於Petchat <i class="mui-pull-right update">V1.0.1</i></a>
						</li>
					</ul>
					<ul class="mui-table-view">
						<li class="mui-table-view-cell" style="text-align: center;">
							<a href="login.html?action=logout" data-action="openwindow">退出登錄</a>
						</li>
					</ul>
				</div>
			</div>
		</div>
		<!--页面主内容区结束-->
	</div>
	<!--单页面结束-->

	<script>
	mui.init();
	//初始化单页view
	var viewApi = mui('#app').view({
		defaultPage: '#setting'
	});

	//初始化单页的区域滚动
	mui('.mui-scroll-wrapper').scroll();

	setTimeout(function () {
		initImgPreview();
	}, 500);

	var view = viewApi.view;
	(function($) {
		//处理view的后退与webview后退
		var oldBack = $.back;
		$.back = function() {
			if (viewApi.canBack()) { //如果view可以后退，则执行view的后退
				viewApi.back();
			} else { //执行webview后退
				oldBack();
			}
		};
		
		//监听页面切换事件方案1,通过view元素监听所有页面切换事件，目前提供pageBeforeShow|pageShow|pageBeforeBack|pageBack四种事件(before事件为动画开始前触发)
		//第一个参数为事件名称，第二个参数为事件回调，其中e.detail.page为当前页面的html对象
		view.addEventListener('pageBeforeShow', function(e) {
			//				console.log(e.detail.page.id + ' beforeShow');
		});
		view.addEventListener('pageShow', function(e) {
			//				console.log(e.detail.page.id + ' show');
		});
		view.addEventListener('pageBeforeBack', function(e) {
			//				console.log(e.detail.page.id + ' beforeBack');
		});
		view.addEventListener('pageBack', function(e) {
			//				console.log(e.detail.page.id + ' back');
		});
	})(mui);
	
	//更换头像
	mui(".mui-table-view-cell").on("tap", "#head", function(e) {
		if(mui.os.plus){
			var a = [{
				title: "从手机相册选择"
			}];
			plus.nativeUI.actionSheet({
				title: "修改头像",
				cancel: "取消",
				buttons: a
			}, function(b) {
				switch (b.index) {
					case 0:
						break;
					case 1:
						getGalleryImg();
						break;
					default:
						break
				}
			})	
		}
		
	});

	/*
	function getImage() {
		var c = plus.camera.getCamera();
		c.captureImage(function(e) {
			plus.io.resolveLocalFileSystemURL(e, function(entry) {
				var s = entry.toLocalURL() + "?version=" + new Date().getTime();
				console.log(s);
				document.getElementById("head-img").src = s;
				document.getElementById("head-img1").src = s;
				//变更大图预览的src
				//目前仅有一张图片，暂时如此处理，后续需要通过标准组件实现
				document.querySelector("#__mui-imageview__group .mui-slider-item img").src = s + "?version=" + new Date().getTime();;;
			}, function(e) {
				console.log("读取拍照文件错误：" + e.message);
			});
		}, function(s) {
			console.log("error" + s);
		}, {
			filename: "_doc/head.jpg"
		})
	}
	*/

	function getGalleryImg() {
		plus.gallery.pick(function(path) {
			uploadFile(path, function(res) {
				assignTmpl(res);
				initImgPreview();				
			});
		});
	};

	document.getElementById("head-img1").addEventListener('tap', function(e) {
		e.stopPropagation();
	});

	function initImgPreview() {
		var imgs = document.querySelectorAll("img.mui-action-preview");
		imgs = mui.slice.call(imgs);
		if (imgs && imgs.length > 0) {
			if (document.getElementById("__mui-imageview__")) {
				document.body.removeChild(document.getElementById("__mui-imageview__"));
			}
			
			var slider = document.createElement("div");
			slider.setAttribute("id", "__mui-imageview__");
			slider.classList.add("mui-slider");
			slider.classList.add("mui-fullscreen");
			slider.style.display = "none";
			slider.addEventListener("tap", function() {
				slider.style.display = "none";
			});
			slider.addEventListener("touchmove", function(event) {
				event.preventDefault();
			});
			var slider_group = document.createElement("div");
			slider_group.setAttribute("id", "__mui-imageview__group");
			slider_group.classList.add("mui-slider-group");
			imgs.forEach(function(value, index, array) {
				//给图片添加点击事件，触发预览显示；
				value.addEventListener('tap', function() {
					slider.style.display = "block";
					_slider.refresh();
					_slider.gotoItem(index, 0);
				})
				var item = document.createElement("div");
				item.classList.add("mui-slider-item");
				var a = document.createElement("a");
				var img = document.createElement("img");
				img.setAttribute("src", value.src);
				a.appendChild(img)
				item.appendChild(a);
				slider_group.appendChild(item);
			});
			slider.appendChild(slider_group);
			document.body.appendChild(slider);
			var _slider = mui(slider).slider();
		}
	}
	</script>

</body>
</html>