<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title</title>
	<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">

	<link rel="stylesheet" href="css/mui.min.css">
	<link rel="stylesheet" type="text/css" href="css/feedback-page.css" />
    <style>
		.top_bg{ height:25px; background-color: #bc9dc9;clear: both;}
		
		
	</style>
	<script src="js/mui.min.js "></script>
	<script src="js/mui.view.js "></script>
    <script src="js/jquery.min.js"></script>
    <script src="js/template-native.js"></script>
    <script src="js/basic.js"></script>
</head>

<body class="mui-fullscreen">
	<header class="mui-bar mui-bar-nav" style=" height: 108px;">
	<div style=" height:21px ; overflow: hidden;">
    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"><span class="mui-icon mui-icon-undo fhui"></span></a>
   
   </div>
    <div class="mui-title"><img src="images/Petchat.png"> <img src="images/CatDog.png"></div>
    <div class="top_bg"></div>
</header>

	<!--页面主结构开始-->
	
		<div class="mui-content">
			
			<div class="mui-pages">
				<div id="account" class="mui-page">
					<div class="mui-page-content">
						<div class="mui-scroll-wrapper" style=" margin-top: 18px;">
							<div class="mui-scroll">
								<ul class="mui-table-view">
									<li class="mui-table-view-cell">
										<a id="picture" class="mui-navigate-right" style=" line-height:40px ;">圖像
											<span class="mui-pull-right head">
												<img class="head-img mui-action-preview" id="picture-src" src="" />
												<input type="hidden" id="picture-path" value="" />
											</span>
										</a>
									</li>
									<li class="mui-table-view-cell">
										<a>選擇類別
											<select id="product-category"></select>
											<script id="product-category-code" type="text/html">
											<% for (var i in list) { %>
												<option value="<%= list[i]["id"] %>"><%= list[i]["name"] %></option>
											<% } %>
											</script>
										</a>
									</li>
									<li class="mui-table-view-cell">
										<a>標題
											<input value="" id="product_name"  style=" height:30px ;width:90%;">
										</a>
									</li>
									<li class="mui-table-view-cell">
										<a>價格
											<input value="" id="product_sale"  style=" height:30px ;width:90%;">
										</a>
									</li>
									<li class="mui-table-view-cell">
										<a>
											<textarea id="product_desp">描述</textarea>
										</a>
									</li>
									<li class="mui-table-view-cell">
										<a id="submit-button">提交</a>
									</li>
								</ul>
							</div>
						</div>
					</div>
				</div>

			</div>
		</div>
	
	<!--页面主结构结束-->

	<script>
	mui.init();

	var member = {};
	var submitting = false;

	mui.plusReady(function() {
		member = myStorage.getItem("member");

		mui.ajax({
			type: "post",
			url: domain + "saas/catalog.php",
			dataType: "json",
			data: {
				action: "list",
				where: {type: 8}
			},
			async: true,
			success: function(json) {
				if(!json.error) {
					jQuery("#product-category").html(template('product-category-code', json));
					
				} else {
					plus.nativeUI.toast(json.message);
				}
			},
			error: function(xhr, type, errorThrown) {}
		});

	});
	
	//选择图片
	mui(".mui-table-view-cell").on("tap", "#picture", function(e) {
		if(mui.os.plus){
			var a = [{
				title: "从手机相册选择"
			}];
			plus.nativeUI.actionSheet({
				title: "選擇圖片",
				cancel: "取消",
				buttons: a
			}, function(b) {
				switch (b.index) {
					case 0:
						break;
					case 1:
						getGalleryImg();
						break;
					default:
						break
				}
			})	
		}
	});

	function getGalleryImg() {
		plus.gallery.pick(function(path) {
			$("#picture-src").attr("src", path);
			$("#picture-path").attr("value", path);
		});
	};
	
	document.getElementById("submit-button").addEventListener("tap", function(event) {
		if (submitting) {
			return;
		}

		if(!jQuery("#product_name").val()) {
			plus.nativeUI.toast("請輸入標題！");
			return false;	
		}

		submitting = true;
		jQuery("#submit-button").html("正在提交");
		
		var profilePage = mui.preload({
			"id": "profile",
			"url": "index.html"
		});
		
		uploadFileData(jQuery("#picture-path").val(), {
				"action": "insert",
				"sbt_name": jQuery("#product_name").val(),
				"sbt_sale": jQuery("#product_sale").val(),
				"sbt_desp": jQuery("#product_desp").val(),
				"sbt_cid": jQuery("#product-category").val()
			}, 
			"saas/product.php", 
			function(res) {
				if (!res.error) {
					plus.nativeUI.toast("發表成功！");
					
					mui.fire(profilePage, "show", null);
					setTimeout(function() {
						mui.openWindow({
							id: "profile",
							show: {
								aniShow: "pop-in"
							},
							waiting: {
								autoShow: false
							}
						});
					}, 0);
					
				} else {
					plus.nativeUI.toast(res.message);

					submitting = false;
					jQuery("#submit-button").html("提交");
				}
			}
		);

	});
	</script>

</body>
</html>