<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title></title>
	<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">

	<link href="css/mui.min.css" rel="stylesheet" />
	<link href="css/mui.indexedlist.css" rel="stylesheet" />
	<link href="css/mui.picker.css" rel="stylesheet" />
	<link href="css/mui.poppicker.css" rel="stylesheet" />
	<style>
		h5{
	        padding-top: 8px;
	        padding-bottom: 8px;
	        text-indent: 12px;
	        background-color:#efeff4;
	    }
		
		.top_bg{ height:30px; background-color: #a669c0;opacity:0.8;}
		#topPopover {
			position:absolute;
			top: 16px;
			right: 6px;
		}
		#topPopover .mui-popover-arrow {
			left: auto;
			right: 6px;
		}
		p {
			text-indent: 22px;
		}
		span.mui-icon {
			font-size: 14px;
			color: #007aff;
			margin-left: -15px;
			padding-right: 10px;
		}
		.mui-popover {
			height: 150px;
		}
		.mui-scroll ul{ margin: 0px; padding:0px ; margin-right: 10px;}
		#comment-list {
			padding:0px 0px 0px 0px;;
			background-color:#fff ;
			text-align: left;
			
			color:#666 ;
			font-size:12px ;
			margin:0px 0px ;
			border-radius:0px 0px 0px 0px;
		}
		#comment-list li {
			border-bottom: 1px  solid #f5f5f5; list-style:none ; background-color:#fbfbfb ;  padding-left: 8px;height:27px; padding-top:2px ;
		}
		#comment-list li p{color:#666 ;  font-size:12px ;}
		#comment-list li p a{color:#b8b7b7 ; }
	</style>
    <script src="js/mui.min.js"></script>
	<script src="js/mui.zoom.js"></script>
	<script src="js/mui.previewimage.js"></script>
    <script src="js/jquery.min.js"></script>
    <script src="js/template-native.js"></script>
    <script src="js/basic.js"></script>
</head>

<body>
	<header class="mui-bar mui-bar-nav">
		<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"><img src="images/home.png"></a>
		<h1 class="mui-title"><img src="images/Petchat.png"> <img src="images/CatDog.png"></h1>
		<a id="menu" class="mui-action-menu mui-icon mui-icon-bars mui-pull-right" style=" color:#333 ; font-weight: bold;" href="#topPopover"></a>
	</header>

	<div class="mui-content" style="background:#fff;">
		<div class="top_bg"></div>

		<div class="xp-tu" id="pullrefresh">
			<ul id="list-view"></ul>
			<script id="list-view-code" type="text/html">
			<% for (var i in list) { %>
				<li>
					<% if (list[i]["member"]["src"] || list[i]["member"]["name"]) { %>
					<img class="img-bor-two wid" src="<%= getvarious("domain") + list[i]["member"]["src"] %>" /><span class="t-p-tile"><%= list[i]["member"]["name"] %></span>
					<% } %>
					
					<div><img class="mui-media-object" src="<%= getvarious("domain") + "uploads/pictures/info/imm" + list[i]["src"] %>"></div>	

					<div class="xp-tu" style="margin-left:5px;">
					<div class="zh-good-x-p" id="heart" rel="like"><img src="images/photo-button-01.png"></div>
					<div class="zh-good-x-p" style="margin-left:10px;" id="promptBtn"><img src="images/photo-button-02.png"></div>
					<div class="zh-good-x-p" style="margin-left:10px;"><img src="images/photo-button-03.png"></div>
					<div class="zh-good-x-p-two"><img src="images/photo-button-04.png" style=" float: left;"><span id="likesCount"><%= list[i]["likes"] %></span></div>
					</div>
					<div id="detail-view"></div>
		
					<ul id="comment-list" class="li-bg-san">
					<% for (var c in list[i]["comment"]) { %>
						<li><p style=" text-indent: 0px;"><b><%= list[i]["comment"][c]["member"]["name"] %>：</b> <%= list[i]["comment"][c]["content"] %></p></li>
					<% } %>
					<li><p style=" text-align: center; border-bottom:none ;"><a href="photo-list-pl.html" data-action="openwindow">查看全部評論</a></p></li>
					</ul>
				</li>
			<% } %>
			</script>
		</div>
	</div>
	
	<!--右上角弹出菜单-->
	<div id="topPopover" class="mui-popover" >
		<div class="mui-popover-arrow"></div>
		<div class="mui-scroll-wrapper">
			<div class="mui-scroll">
				<ul>
					<li class="mui-table-view-cell"><a href="publish-photo.html" class="mui-navigate-right" data-action="openwindow">發表圖片</a></li>
					<li class="mui-table-view-cell"><a href="my-photo.html" class="mui-navigate-right" data-action="openwindow">我的圖片</a>
					</li>
					<li class="mui-table-view-cell"><a href="setting.html" class="mui-navigate-right" data-action="openwindow">個人主頁</a>
					</li>
					<li class="mui-table-view-cell"></li>
				</ul>
			</div>
		</div>

	</div>
	
	<script>
		mui.init({
			swipeBack: true, //启用右滑关闭功能
			pullRefresh: {
				container: '#pullrefresh',
				down: {
					callback: pulldownRefresh
				},
				up: {
					contentrefresh: '正在加载...',
					callback: pullupRefresh
				}
			}
		});
		/**
		 * 下拉刷新具体业务实现
		 */
		function pulldownRefresh() {
			alert("ddd")

			setTimeout(function() {
				mui('#pullrefresh').pullRefresh().endPulldownToRefresh((++ count > 4));
				alert("ddd")

				/*
				var table = document.body.querySelector('.mui-table-view');
				var cells = document.body.querySelectorAll('.mui-table-view-cell');
				for (var i = cells.length, len = i + 3; i < len; i++) {
					var li = document.createElement('li');
					li.className = 'mui-table-view-cell';
					li.innerHTML = '<a class="mui-navigate-right">Item ' + (i + 1) + '</a>';
					//下拉刷新，新纪录插到最前面；
					table.insertBefore(li, table.firstChild);
				}
				 //refresh completed
				 */

			}, 1500);
		}

		var page = 1;
		var count = 0;
		/**
		 * 上拉加载具体业务实现
		 */
		function pullupRefresh() {
			setTimeout(function() {
				mui('#pullrefresh').pullRefresh().endPullupToRefresh((++ count > 2)); //参数为true代表没有更多数据了。

				mui.ajax({
					type: "post",
					url: domain + "saas/info.php",
					dataType: "json",
					data: {action: "list", where: {cid: "15,"}, type: 5},
					async: true,
					success: function(json) {
						if(!json.error) {
							count = 0;
							jQuery("#list-view").html(jQuery("#list-view").html() + template('list-view-code', json));
							//assignTmpl(json);
							
						} else {
							plus.nativeUI.toast(json.message);
						}
					},
					error: function(xhr, type, errorThrown) {
						//alert(JSON.stringify(xhr))
					}
				});

			}, 2000);
		}
		if (mui.os.plus) {
			mui.plusReady(function() {
				setTimeout(function() {
					mui('#pullrefresh').pullRefresh().pullupLoading();
				}, 1000);

			});
		} else {
			mui.ready(function() {
				mui('#pullrefresh').pullRefresh().pullupLoading();
			});
		}

		mui.plusReady(function() {
			mui.ajax({
				type: "post",
				url: domain + "saas/info.php",
				dataType: "json",
				data: {action: "list", where: {cid: "15,"}, type: 5},
				async: true,
				success: function(json) {
					if(!json.error) {
						jQuery("#list-view").html(template('list-view-code', json));
						//assignTmpl(json);
						
					} else {
						plus.nativeUI.toast(json.message);
					}
				},
				error: function(xhr, type, errorThrown) {
					//alert(JSON.stringify(xhr))
				}
			});
		});
	</script>
	<script type="text/javascript" charset="utf-8">
		var cata_type = 5;
		var member = {};
	
		
		
		mui.plusReady(function() {
			member = myStorage.getItem("member");
				
			mui.ajax({
				type: "post",
				url: domain + "saas/info.php",
				dataType: "json",
				data: {
					action: "detail",
					where: {path: getUrlParam("url"), type: cata_type}
				},
				async: true,
				success: function(json) {
					if(!json.error) {
						if (json.detail.member) {
							jQuery("#member-photo").html(template("member-photo-code", json));
						}
						jQuery("#detail-photo").html(template("detail-photo-code", json));
						jQuery("#detail-view").html(template("detail-view-code", json));
						assignTmpl(json);
						initComment("promptBtn", "heart", "likesCount");
							
					} else {
						plus.nativeUI.toast(json.message);
					}
				},
				error: function(xhr, type, errorThrown) {}
			});
		});

	</script>

</body>
</html>